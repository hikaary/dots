# –ü–ª–∞–≥–∏–Ω—ã
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'omerxx/tmux-floax'
set -g @resurrect-save 'S'
set -g @resurrect-restore 'R'
set -g update-environment "DISPLAY"

# –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ –∏–∑ JSON
run-shell "tmux set-environment -g TMUX_BG $(jq -r .colors.background ~/.cache/material/colors.json)"
run-shell "tmux set-environment -g TMUX_FG $(jq -r .colors.onBackground ~/.cache/material/colors.json)"
run-shell "tmux set-environment -g TMUX_PRIMARY $(jq -r .colors.primary ~/.cache/material/colors.json)"
run-shell "tmux set-environment -g TMUX_SURFACE_VARIANT $(jq -r .colors.surfaceVariant ~/.cache/material/colors.json)"
run-shell "tmux set-environment -g TMUX_ON_SURFACE_VARIANT $(jq -r .colors.onSurfaceVariant ~/.cache/material/colors.json)"
run-shell "tmux set-environment -g TMUX_PRIMARY_CONTAINER $(jq -r .colors.primaryContainer ~/.cache/material/colors.json)"
run-shell 'tmux set -g status-style bg="#{TMUX_BG}"'

# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
set -g status-position top
set -g status-justify centre
set -g status-style bg=default
set -g default-terminal "xterm-256color"
set -ga terminal-overrides ",xterm-256color:Tc"
set -g terminal-overrides ',xterm-256color:Tc'
set -as terminal-overrides ',xterm*:sitm=\E[3m'

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫–æ–Ω
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
set -g status-left "#[fg=#{TMUX_PRIMARY},bold] tmux "
set -g status-left-length 20
set -g status-right "#[fg=#{TMUX_PRIMARY},bold]#{?client_prefix,‚å®Ô∏è ,}#{?pane_synchronized,üîÑ ,}#(TZ='Asia/Tokyo' date '+%H:%M') "
set -g status-right-length 50

# –°—Ç–∏–ª—å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–∫–æ–Ω
set -g window-status-format "#[fg=#{TMUX_ON_SURFACE_VARIANT},bg=#{TMUX_BG}] #I:#W "

# –°—Ç–∏–ª—å –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–∫–Ω–∞
set -g window-status-current-format "#[fg=#{TMUX_BG},bg=#{TMUX_PRIMARY},bold] #I:#W "

# –ö–ª–∞–≤–∏—à–∞ –ø—Ä–µ—Ñ–∏–∫—Å–∞
unbind C-b 
set-option -g prefix C-a
bind C-a send-prefix

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
bind r source-file ~/.config/tmux/tmux.conf \; display "–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω–æ!"

# –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–µ–π
bind v split-window -h -c "#{pane_current_path}"  # –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ

# –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ø–∞–Ω–µ–ª–µ–π
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –ø–∞–Ω–µ–ª—è–º–∏
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É –ø–∞–Ω–µ–ª—è–º–∏ —Å –ø–æ–º–æ—â—å—é Alt + –∫–ª–∞–≤–∏—à–∏ —Å—Ç—Ä–µ–ª–æ–∫
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ø–∞–Ω–µ–ª–µ–π —Å –ø–æ–º–æ—â—å—é Shift + –∫–ª–∞–≤–∏—à–∏ —Å—Ç—Ä–µ–ª–æ–∫
bind -n S-Left resize-pane -L 2
bind -n S-Right resize-pane -R 2
bind -n S-Up resize-pane -U 2
bind -n S-Down resize-pane -D 2

# –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–∞–∫–µ—Ç–æ–≤
bind Space next-layout

# –ú–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏—è/–º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è —Ç–µ–∫—É—â–µ–π –ø–∞–Ω–µ–ª–∏
bind z resize-pane -Z

# –ó–∞–∫—Ä—ã—Ç–∏–µ —Ç–µ–∫—É—â–µ–π –ø–∞–Ω–µ–ª–∏
bind x kill-pane

# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ–∫–Ω–∞ —Å —Ç–µ–∫—É—â–∏–º –ø—É—Ç–µ–º
bind c new-window -c "#{pane_current_path}"

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤–≤–æ–¥–∞ –≤–æ –≤—Å–µ—Ö –ø–∞–Ω–µ–ª—è—Ö
bind y setw synchronize-panes

# –ü–æ–∫–∞–∑–∞—Ç—å –Ω–æ–º–µ—Ä–∞ –ø–∞–Ω–µ–ª–µ–π
bind q display-pane

# –†–µ–∂–∏–º –≤—ã–±–æ—Ä–∞ –ø–∞–Ω–µ–ª–∏/–æ–∫–Ω–∞
bind P choose-tree

# –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –¥–≤—É–º—è –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ –ø–∞–Ω–µ–ª—è–º–∏
bind Tab last-pane

# –¢–µ—Ä–º–∏–Ω–∞–ª
set -g @sessionx-bind 'p'

# –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –æ–∫–Ω–∞
bind-key m command-prompt -p "–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –æ–∫–Ω–æ –Ω–∞ –ø–æ–∑–∏—Ü–∏—é: " "run-shell '~/.config/tmux/scripts/move_windows.sh %%'"

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π
bind S run-shell '~/.config/tmux/plugins/tmux-resurrect/scripts/save.sh'
bind R run-shell '~/.config/tmux/plugins/tmux-resurrect/scripts/restore.sh'

# –¶–≤–µ—Ç–∞ –ø–∞–Ω–µ–ª–µ–π
set -g pane-border-style fg="#{TMUX_SURFACE_VARIANT}"
set -g pane-active-border-style fg="#{TMUX_PRIMARY}"

# –¶–≤–µ—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
set -g message-style bg="#{TMUX_PRIMARY_CONTAINER}",fg="#{TMUX_FG}"

run '~/.config/tmux/plugins/tpm/tpm'
